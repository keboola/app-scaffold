[
    {
        "configuration": {
            "output": [
                {
                    "destination": "out.c-reviews.location",
                    "primaryKey": [
                        "location_id"
                    ],
                    "source": "out_locations",
                    "incremental": true,
                    "deleteWhereColumn": "",
                    "deleteWhereOperator": "eq",
                    "deleteWhereValues": []
                }
            ],
            "queries": [
                "--create output table with locations\n--keep location importnat information\n--user-friendly names\nCREATE TABLE \"out_locations\"\nAS\n    SELECT\n        \"id\"      AS \"location_id\",\n        \"name\"    AS \"location\",\n        \"address\" AS \"street\",\n        \"city\",\n        \"zipcode\",\n        \"country\",\n        \"state\",\n        \"latitude\",\n        \"longitude\"\n    FROM \"locations\";"
            ],
            "input": [
                {
                    "source_search": {
                        "key": "bdm.scaffold.table.tag",
                        "value": "bdm.kds-team.ex-reviewtrackers.locations"
                    },
                    "destination": "locations",
                    "datatypes": [],
                    "whereColumn": "",
                    "whereValues": [],
                    "whereOperator": "eq",
                    "columns": [],
                    "loadType": "clone"
                }
            ],
            "name": "Locations",
            "packages": [],
            "requires": [],
            "backend": "snowflake",
            "type": "simple",
            "id": "492076531",
            "phase": 1,
            "disabled": false,
            "description": ""
        },
        "description": "",
        "name": "Locations"
    },
    {
        "configuration": {
            "output": [
                {
                    "destination": "out.c-reviews.pre_nlp_review_response",
                    "source": "out_review_response",
                    "primaryKey": [
                        "review_response_id"
                    ],
                    "incremental": true,
                    "deleteWhereColumn": "",
                    "deleteWhereOperator": "eq",
                    "deleteWhereValues": []
                }
            ],
            "queries": [
                "CREATE TABLE \"review_response_tmp\"\nAS\n    SELECT\n        \"id\" || '-review'                                AS \"review_response_id\",\n        \"id\"                                             AS \"review_id\",\n        \"l\".\"location_id\"                                AS \"location_id\",\n        'Review'                                         AS \"type\",\n        trim(regexp_replace(\"published_at\", 'T|Z', ' ')) AS \"published_at\",\n        \"source_name\"                                    AS \"source\",\n        \"author\"                                         AS \"author\",\n        \"name\"                                           AS \"review_title\",\n        \"content\"                                        AS \"text\",\n        \"permalink\"                                      AS \"review_url\",\n        \"rating\"                                         AS \"rating\"\n    FROM \"reviews\" \"r\"\n             LEFT JOIN \"locations\" \"l\"\n                       ON \"r\".\"location_id\" = \"l\".\"location_id\"\n    UNION ALL\n    SELECT\n        \"a\".\"id\" || '-response'                              AS \"review_response_id\",\n        \"b\".\"id\"                                             AS \"review_id\",\n        \"l\".\"location_id\"                                    AS \"location_id\",\n        'Response'                                           AS \"type\",\n        trim(regexp_replace(\"a\".\"published_at\", 'T|Z', ' ')) AS \"published_at\",\n        \"b\".\"source_name\"                                    AS \"source\",\n        \"l\".\"location\"                                       AS \"author\",\n        \"b\".\"name\"                                           AS \"review_title\",\n        \"a\".\"content\"                                        AS \"text\",\n        \"b\".\"permalink\"                                      AS \"review_url\",\n        \"b\".\"rating\"                                         AS \"rating\"\n    FROM \"responses\" \"a\"\n             INNER JOIN \"reviews\" \"b\"\n                        ON \"a\".\"review_id\" = \"b\".\"id\"\n             LEFT JOIN \"locations\" \"l\"\n                       ON \"a\".\"location_id\" = \"l\".\"location_id\";",
                "CREATE TABLE \"out_review_response\"\nAS\n    SELECT\n        \"review_response_id\",\n        \"review_id\",\n        \"location_id\",\n        \"type\",\n        \"published_at\",\n        \"source\",\n        \"author\",\n        \"review_title\",\n        \"text\",\n        row_number() OVER (PARTITION BY \"review_id\" ORDER BY \"published_at\" ASC) AS \"text_order\",\n        \"review_url\",\n        \"rating\"\n    FROM \"review_response_tmp\""
            ],
            "input": [
                {
                    "source_search": {
                        "key": "bdm.scaffold.table.tag",
                        "value": "bdm.kds-team.ex-reviewtrackers.reviews"
                    },
                    "destination": "reviews",
                    "datatypes": [],
                    "whereColumn": "",
                    "whereValues": [],
                    "whereOperator": "eq",
                    "columns": [],
                    "loadType": "clone"
                },
                {
                    "source_search": {
                        "key": "bdm.scaffold.table.tag",
                        "value": "bdm.kds-team.ex-reviewtrackers.responses"
                    },
                    "destination": "responses",
                    "datatypes": [],
                    "whereColumn": "",
                    "whereValues": [],
                    "whereOperator": "eq",
                    "columns": [],
                    "loadType": "clone"
                },
                {
                    "source": "out.c-reviews.location",
                    "destination": "locations",
                    "datatypes": [],
                    "whereColumn": "",
                    "whereValues": [],
                    "whereOperator": "eq",
                    "columns": [],
                    "loadType": "clone"
                }
            ],
            "name": "Reviews & Responses",
            "packages": [],
            "requires": [],
            "backend": "snowflake",
            "type": "simple",
            "id": "503497028",
            "phase": "2",
            "disabled": false,
            "description": ""
        },
        "description": "",
        "name": "Reviews & Responses"
    }
]
