[
    {
        "configuration": {
            "output": [
                {
                    "destination": "out.c-reviews.reviews_response",
                    "source": "out_reviews_response",
                    "primaryKey": [
                        "review_response_id"
                    ]
                },
                {
                    "destination": "out.c-reviews.topic",
                    "source": "out_topic",
                    "primaryKey": [
                        "topic_id"
                    ]
                },
                {
                    "destination": "out.c-reviews.review_response_topic",
                    "source": "out_review_response_topic",
                    "primaryKey": [
                        "review_response_id",
                        "topic_id"
                    ]
                }
            ],
            "queries": [
                "CREATE TABLE \"out_reviews_response\"\nAS\n    SELECT\n        \"d\".\"review_response_id\" AS \"review_response_id\",\n        \"r\".\"review_id\"          AS \"review_id\",\n        \"r\".\"type\"\t\t\t\t AS \"type\",\n        \"r\".\"location_id\"        AS \"location_id\",\n        \"r\".\"published_at\"       AS \"published_at\",\n        \"r\".\"review_title\"       AS \"review_title\",\n        IFF(LENGTH(\"r\".\"text\") > 1024,LEFT(\"r\".\"text\",1021)||'...',\"r\".\"text\") AS \"text\",\n        \"r\".\"rating\"             AS \"rating\",\n        \"r\".\"source\"             AS \"source\",\n        \"r\".\"review_url\"         AS \"source_url\",\n        \"d\".\"sentimentLabel\"     AS \"sentiment_label\", -- original polarity form NLP\n        \"d\".\"sentimentValue\"     AS \"sentiment_value\",\n        --ABS(\"d\".\"sentimentPolarity\") * SIGN(\"r\".\"rating\" - 3)           AS \"sentiment_label_corrected\", -- brutally changed sentiment polarity based on rating score\n        \"d\".\"usedChars\"          AS \"text_length\"      -- for review elaborative purposes\n    FROM \"nlp_documents\" \"d\"\n             LEFT JOIN \"pre_nlp_review_response\" \"r\"\n                       ON \"d\".\"review_response_id\" = \"r\".\"review_response_id\";",
                "-- list of topics related to the analysed texts\nCREATE TABLE \"response_topic_tmp\"\nAS\n    SELECT DISTINCT\n        \"review_response_id\"                                     AS \"review_response_id\",\n        \"name\"                                                   AS \"topic_group\",\n        \"subject\",\n        \"object\",\n        \"type\"                                                   AS \"type\",\n        (\"name\"::VARCHAR(255) || ' ' || \"subject\"::VARCHAR(255)) AS \"topic\",\n        --\"sentimentPolarity\"                                      AS \"sentiment_polarity\",\n        (CASE\n             WHEN \"subjectType\" = '' AND \"objectType\" = ''\n                 THEN 'other'\n             WHEN \"subjectType\" = ''\n                 THEN \"objectType\"\n             WHEN \"objectType\" = ''\n                 THEN \"subjectType\"\n             ELSE 'other'\n         END)                                                    AS \"category_type\",\n        \"sentimentLabel\"                                         AS \"sentiment_label\",\n        sum(\"sentimentValue\")                                    AS \"sentiment_value\"\n    FROM \"nlp_relations\"\n    WHERE \"subject\" <> ''\n       OR \"object\" <> ''\n    GROUP BY 1, 2, 3, 4, 5, 6, 7, 8;",
                "-- creation of unique topics\n-- create PK\nCREATE TABLE \"out_topic\"\nAS\n    SELECT DISTINCT\n        MD5(\"topic_group\" || '-' || \"subject\" || '-' || \"object\" || '-' || \"type\" || '-' ||\n            \"category_type\") AS \"topic_id\",\n        \"topic_group\"        AS \"topic_group\",\n        \"topic\",\n        \"subject\"            AS \"subject\",\n        \"object\"             AS \"object\",\n        \"type\"               AS \"type\",\n        \"category_type\"      AS \"category_type\"\n    FROM \"response_topic_tmp\";",
                "-- creaton paring table\nCREATE TABLE \"out_review_response_topic\"\nAS\n    SELECT\n        \"review_response_id\" AS \"review_response_id\",\n        MD5(\"topic_group\" || '-' || \"subject\" || '-' || \"object\" || '-' || \"type\" || '-' ||\n            \"category_type\") AS \"topic_id\",\n        \"sentiment_label\",\n        \"sentiment_value\"\n    FROM \"response_topic_tmp\";"
            ],
            "input": [
                {
                    "source": "out.c-reviews.pre_nlp_review_response",
                    "destination": "pre_nlp_review_response",
                    "datatypes": [],
                    "whereColumn": "",
                    "whereValues": [],
                    "whereOperator": "eq",
                    "columns": [],
                    "loadType": "clone"
                },
                {
                    "source_search": {
                        "key": "bdm.scaffold.table.tag",
                        "value": "bdm.geneea.nlp-analysis-v2.analysis-result-documents"
                    },
                    "destination": "nlp_documents",
                    "datatypes": [],
                    "whereColumn": "",
                    "whereValues": [],
                    "whereOperator": "eq",
                    "columns": [],
                    "loadType": "clone"
                },
                {
                    "source_search": {
                        "key": "bdm.scaffold.table.tag",
                        "value": "bdm.geneea.nlp-analysis-v2.analysis-result-relations"
                    },
                    "destination": "nlp_relations",
                    "datatypes": [],
                    "whereColumn": "",
                    "whereValues": [],
                    "whereOperator": "eq",
                    "columns": [],
                    "loadType": "clone"
                }
            ],
            "name": "Reviews & Responses Enhancement",
            "packages": [],
            "requires": [],
            "backend": "snowflake",
            "type": "simple",
            "id": "505080955",
            "phase": 1,
            "disabled": false
        },
        "description": "Combining processed data with Geneea app output.",
        "name": "Reviews & Responses Enhancement"
    }
]
