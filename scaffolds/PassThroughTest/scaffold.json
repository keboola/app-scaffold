{
    "operations": [
        {
            "operation": "create.configuration",
            "id": "snowflakeExtractor",
            "KBCComponentId": "keboola.ex-db-snowflake",
            "payload": {
                "name": "Extract sample data",
                "configuration": {
                    "parameters": {
                        "db": {
                            "port": 443,
                            "ssh": {
                                "sshPort": 22
                            }
                        },
                        "tables": [
                            {
                                "enabled": true,
                                "name": "ACCOUNT",
                                "incremental": false,
                                "outputTable": "in.c-keboola-ex-db-snowflake-sample.account",
                                "table": {
                                    "schema": "HELP_TUTORIAL",
                                    "tableName": "ACCOUNT"
                                },
                                "columns": [],
                                "primaryKey": [],
                                "id": 1509
                            },
                            {
                                "enabled": true,
                                "name": "USER",
                                "incremental": false,
                                "outputTable": "in.c-keboola-ex-db-snowflake-sample.user",
                                "table": {
                                    "schema": "HELP_TUTORIAL",
                                    "tableName": "USER"
                                },
                                "columns": [],
                                "primaryKey": [],
                                "id": 85768
                            }
                        ]
                    },
                    "processors": {
                        "after": [
                            {
                                "definition": {
                                    "component": "keboola.processor-add-metadata"
                                },
                                "parameters": {
                                    "tables": [
                                        {
                                            "table": "in_c-keboola-ex-db-snowflake-sample_user.csv.gz",
                                            "metadata": [
                                                {
                                                    "key": "bdm.scaffold.entity.type",
                                                    "value": "user"
                                                }
                                            ]
                                        },
                                        {
                                            "table": "in_c-keboola-ex-db-snowflake-sample_account.csv.gz",
                                            "metadata": [
                                                {
                                                    "key": "bdm.scaffold.entity.type",
                                                    "value": "account"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                }
            }
        },
        {
            "operation": "create.configuration",
            "id": "connectionWriter",
            "KBCComponentId": "keboola.wr-storage",
            "payload": {
                "name": "Write processed tables",
                "configuration": {
                    "parameters": {
                        "url": "https://connection.keboola.com/"
                    }
                }
            }
        },
        {
            "operation": "create.configrows",
            "refConfigId": "connectionWriter",
            "rows": [
                {
                    "name": "user-processed",
                    "configuration": {
                        "storage": {
                            "input": {
                                "tables": [
                                    {
                                        "source_search": {
                                            "key": "bdm.scaffold.entity.type",
                                            "value": "user"
                                        },
                                        "changed_since": "",
                                        "destination": "user-processed"
                                    }
                                ]
                            }
                        },
                        "parameters": {
                            "mode": "recreate"
                        }
                    }
                }
            ]
        },
        {
            "operation": "create.orchestration",
            "payload": {
                "name": "Main",
                "tasks": [
                    {
                        "component": "keboola.ex-db-snowflake",
                        "refConfigId": "snowflakeExtractor",
                        "action": "run",
                        "timeoutMinutes": null,
                        "active": true,
                        "continueOnFailure": false,
                        "phase": "Extraction"
                    },
                    {
                        "component": "keboola.wr-storage",
                        "refConfigId": "connectionWriter",
                        "action": "run",
                        "timeoutMinutes": null,
                        "active": true,
                        "continueOnFailure": false,
                        "phase": "Writing"
                    }
                ]
            }
        }
    ]
}
